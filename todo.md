# 📘 StudySpark プロジェクト実装計画（プレゼン対応版）

## 🎯 プレゼンセレクション対応方針
- **デモで見える機能を最優先**: ユーザー体験に直結する部分を優先実装
- **モック → 本実装の段階的移行**: 見た目は本物、裏側は必要に応じてモック
- **セキュリティ・性能最適化は後回し**: デモ後に順次強化

## 🔍 全体進捗状況
- 🟢 フロントエンドの基本実装（レイアウト、ナビゲーション、モックデータ連携）: **完了**
- 🟡 Supabase連携: **準備段階**（スキーマ定義済み、一部リポジトリ実装済み）
- 🔴 ChatGPT連携: **未着手**（APIキー設定済み）

## ⚠️ プレゼン前後の対応区分
- **プレゼン前に実装**: メールアドレスでのログイン機能
- **プレゼン後の課題**: Google認証連携（現在機能していないため後回し）

## 📅 プレゼン前の実装計画

### フェーズ1: デモ対応優先実装（〜プレゼンセレクション）
- [ ] **最低限のSupabase Auth連携**
  - [ ] メールアドレスログイン機能の実装（UI→DB連携）
  - [ ] オンボーディング画面からのプロフィール保存
- [ ] **トークルーム機能のモック強化**
  - [ ] 固定シナリオでのAIコーチ対話デモ準備
  - [ ] 進捗グラフ・ゲージのデモ表示機能
- [ ] **ゴールナビ・スパーク機能のDB保存**
  - [ ] 目標設定のDB保存機能（LocalStorage→Supabase）
  - [ ] 学習計画のDB保存（表示データ優先）
- [ ] **データ連携のモック化**
  - [ ] サーバー側で事前準備したレスポンスを使用
  - [ ] API呼び出しの枠組みだけ整備

### フェーズ2: 本実装への移行（プレゼンセレクション〜本番プレゼン）
- [ ] **ChatGPT連携の本実装**
  - [ ] トークルーム機能のAI応答生成
  - [ ] 学習計画生成の実装
- [ ] **本格的なDB連携の実装**
  - [ ] 各機能のCRUD操作の完全実装
  - [ ] ユーザーデータの保存と取得
- [ ] **機能の洗練**
  - [ ] UIの微調整とアニメーション追加
  - [ ] フィードバック反映と改善

### フェーズ3: 本番後の強化（プレゼン後）
- [ ] **セキュリティ強化**
  - [ ] RLSポリシーの適用
  - [ ] 認証・認可の厳格化
  - [ ] **Google認証連携の実装と修正**
- [x] **パフォーマンス最適化**
  - [x] インデックス設計とクエリ最適化
  - [ ] データアクセスパターンの改善
- [ ] **拡張機能の実装**
  - [ ] 分析機能の追加
  - [ ] ユーザーフィードバック対応

## 🎬 セレクション向けデモの実装/モック区分

### 実装する部分（本物）
- **認証・プロフィール**
  - ログイン/サインアップの基本フロー（Supabase Authと連携）
  - ユーザープロフィール情報の保存と取得
  - オンボーディングの完全な流れ

- **データの永続化**
  - 目標設定データのSupabase保存
  - 学習計画の基本データ保存
  - メッセージ履歴の保存（トークルーム）

- **UI/UX完成度**
  - 全画面のレスポンシブ対応（特にモバイル）
  - アニメーションとトランジション
  - データ可視化コンポーネント

### モックで対応する部分
- **AIコーチング機能**
  - 事前に用意した応答パターン
  - シナリオベースの対話フロー
  - モック応答を返すAPI

- **学習計画生成ロジック**
  - 簡易アルゴリズムによる計画生成
  - 事前に用意したパターンの使用
  - 複雑な日付計算は固定シナリオで対応

- **データ分析・集計**
  - フロントエンドで計算したモックデータ
  - 固定のグラフ・統計表示

## 📊 機能別優先実装事項（プレゼン前）

### 1️⃣ ユーザー認証・プロフィール
- [x] **データベース設計** ✅
- [x] **UI実装** ✅
- [ ] **最低限のSupabase連携**
  - [ ] ログイン処理の実装（見た目重視）
  - [ ] プロフィール情報のDB保存
  - [ ] オンボーディングフローの完成

### 2️⃣ ゴールナビ（目標設定）
- [x] **UI実装** ✅
- [ ] **デモ用データ準備**
  - [ ] 教材マスターデータの準備（ハードコード可）
  - [ ] 目標設定情報のDB保存
  - [ ] 目標取得・表示機能

### 3️⃣ スパーク（学習計画）
- [x] **UI実装** ✅
- [ ] **計画機能のデモ実装**
  - [ ] 計画生成機能の簡易実装（固定アルゴリズム）
  - [ ] 計画データのDB保存
  - [ ] 問題状態の保存・表示連携

### 4️⃣ カウントダウン（進捗可視化）
- [x] **UI実装** ✅
- [ ] **進捗表示機能**
  - [ ] タスクデータの取得・表示
  - [ ] 日/週/月表示切替の完全実装
  - [ ] 状態更新のDB連携

### 5️⃣ トークルーム（振り返り機能）
- [x] **基本UI実装** ✅
- [ ] **デモ対応強化**
  - [ ] 固定シナリオ対話の実装
  - [ ] メッセージ履歴の保存・表示
  - [ ] 進捗グラフ表示コンポーネント実装

## 🔧 技術的実装優先度

### 最優先（プレゼン前必須）
- [ ] **認証フロー**
  - Supabase Auth基本連携
  - セッション管理（ログイン状態保持）
- [ ] **データ永続化**
  - 主要データのDB保存
  - 履歴データの表示
- [ ] **見栄えの良いUI完成**
  - アニメーション・トランジション
  - レスポンシブ対応（モバイル優先）

### 中優先（プレゼン前に余裕があれば）
- [ ] **ChatGPT基本連携**
  - 簡易的なAI応答生成
  - 固定プロンプトでの動作確認
- [ ] **データ連携機能**
  - 機能間のデータ参照
  - 集計・分析表示

### 後回し（プレゼン後対応）
- [ ] **セキュリティ強化**
  - RLSポリシー実装
  - 認証フロー完全対応
- [ ] **パフォーマンス最適化**
  - インデックス設計
  - クエリ最適化
- [ ] **テスト自動化**
  - 単体/E2Eテスト
  - CI/CD構築

## 📝 デモ戦略とプレゼンのポイント

### デモ準備
- **仮データの準備**: デモに適した学習計画・進捗状態を事前に用意
- **シナリオ作成**: 操作手順を明確にして、スムーズに機能を見せる流れを計画
- **トラブル対策**: 接続エラーなどの対応策（オフラインでも動作するフォールバック）
- **キャプチャ素材**: スクリーンショットやGIF動画を事前に準備

### プレゼン戦略のポイント
- **主要5機能を簡潔に見せる**: 各機能で「これができる」という価値提案を1つずつ実演
- **差別化ポイントを強調**: 
  - AIコーチングによる学習モチベーション維持
  - 学習計画の自動生成による効率化
  - 振り返り機能による自己成長の促進
- **ターゲットユーザーの課題解決**: 学生の試験対策における悩みを解決する点を明確に
- **完成度と実用性をアピール**: 見た目の完成度と実用的な機能を示す

## 🚨 優先度の高いリスク対応項目
- [ ] **ChatGPT連携PoC（技術検証）**
  - [ ] 簡易プロンプトでの応答生成テスト
  - [ ] 学習データの組み込みと応答品質検証
  - [ ] APIコスト見積もり

## 📅 実装フェーズ計画

### フェーズ1: 技術検証とモック置き換え準備（現在）
- [x] API基本構造の整備（`app/api`ディレクトリ作成） ✅
- [ ] **ChatGPT連携PoC実施**（リスク早期検証）
- [ ] リポジトリパターンの完成（各テーブル用リポジトリ実装）
- [ ] 教材マスターデータ投入方法の決定と実装
- [ ] モック認証からSupabase Auth切り替え準備
- [ ] 学習計画生成アルゴリズムの単体実装とテスト

### フェーズ2: Supabase基本連携
- [ ] 認証システム完全移行（Supabase Auth）
- [ ] RLSポリシー設計・実装（認証ユーザーデータ閲覧制限）
- [ ] ゴール設定・取得機能の実装
- [x] DB性能最適化・インデックス設計（特に`question_attempt_logs`）
- [ ] 学習計画・タスク管理のDB連携
- [ ] 基本的なDB連携のE2Eテスト実施

### フェーズ3: ChatGPT連携と機能拡張
- [ ] トークルーム向けプロンプト開発と応答調整
- [ ] チャットAPIエンドポイント実装
- [ ] 学習計画生成AI連携の実装
- [ ] トークルーム機能強化（3ステップ、進捗表示）
- [ ] 高度な結合テスト（複数機能連携）

### フェーズ4: 完成度向上とパフォーマンス最適化
- [ ] リアルタイムデータ同期機能強化
- [ ] グラフ・可視化機能の強化
- [ ] レスポンシブデザインの完成
- [ ] 負荷テストと最終パフォーマンス調整
- [ ] ユーザーテストとフィードバック対応

## 🧪 テスト計画
- **単体テスト**: 複雑なロジック（学習計画生成、日付計算）に焦点
- **結合テスト**: 機能間連携、特にDB操作→ChatGPT入力→UI表示のフロー
- **E2Eテスト**: 主要ユーザーフローをカバー
- **負荷テスト**: `question_attempt_logs`などの高頻度更新テーブルのパフォーマンス

## 🛠 システム構成図
```
StudySpark
├── フロントエンド (Next.js App Router)
│   ├── ユーザー認証・プロフィール管理
│   ├── ゴールナビ
│   ├── スパーク
│   ├── カウントダウン
│   └── トークルーム
│
├── バックエンド
│   ├── Supabase (DB・認証)
│   │   ├── PostgreSQL (Prisma経由でアクセス)
│   │   └── RLS (Row Level Security)
│   └── ChatGPT API (AI機能)
│       ├── 学習計画生成
│       └── コーチング対話
│
└── データ構造
    ├── ユーザー・認証データ
    ├── 教材マスターデータ
    ├── 目標・試験範囲データ
    ├── 学習計画・タスクデータ
    ├── 問題状態記録データ
    └── 振り返り・対話データ
```

## 📝 実装上の注意点
- **UI実装の定義**: 「UI実装 ✅」はモバイルビューでの基本機能・スタイル適用済みを意味（レスポンシブ対応は一部のみ）
- **DB設計再確認事項**:
  - `goals.reason_type`と`reason_options.is_custom`の役割整理
  - `learning_tasks.order_in_day`の順序決定ルールの明確化
- **ChatGPT連携コスト**: 計画生成・トーク機能でのトークン使用量を監視し、必要に応じて調整
- [x] **パフォーマンス最適化**: `question_attempt_logs`などの高頻度アクセステーブルに注意
